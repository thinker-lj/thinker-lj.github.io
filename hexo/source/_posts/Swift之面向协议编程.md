---
title: Swift之面向协议编程
date: 2016-06-18 19:59:29
tags: [POP, 协议]
categories: Swift
---


> Swift 就是一个面向协议的编程语言。 —— Dave Abrahams

-------

# & 引子
在去年的 **WWDC**，Dave Abrahams 有个非常具有影响力并让人大开眼界的布道，主要内容就是基于 Swift 的面向协议编程。在接触 Swift 这段时间，也确实发现正如这位教授所说，Swift简直就是个面向协议的编程语言。在这门语言的标准库中有着大量的协议身影。既然 Swift 的构造基石都是这样，那我们有必要思考下这样做到底能带来什么。虽然在工业级项目中我和大多数iOS开发者一样，仍然在使用 **Objective-C**，面向对象编程的事件，每天都在发生着，但 Swift 天然具有的这种面向协议编程（我们姑且叫它 **POP** 吧）特性，给我们打开了一扇门，代码还可以这样写……

-------

# & 硬生生的栗子
毕竟没在工业级项目中使用 Swift 的经验，只好生造个栗子，不过结合了常见场景，足以阐述问题。在之前的一个项目中遇到这样一种场景：一个发布动态按钮，需要通过抖动和间歇缩放来提醒用户，也算是个用户引导吧。那我们先用 Objective-C 实现一个不经思考的版本：
```objc
@implementation XXViewController
- (void)shakeAndZoom {
	// 具体实现
}
@end
```
很快，PM 发现这个效果还不错，她决定应用到其他的需求中，这当然难不倒我们，那就直接用 Category 实现吧，以后再有类似需求，拿来直接用。于是重构成了这样：
```objc
@implementation UIButton(shakeAndZoom)
- (void)shakeAndZoom {
	// 具体实现
}
@end

@implementation XXViewController
- (void)shakeAndZoom {
	[_btn shakeAndZoom];
}
@end
```
以上简化了具体了实现，这应该是在具体项目中，我们经常会碰到的场景了。其实还可以再延伸一步，PM 如果要求不只是按钮的效果，扩大效果范围呢？那也难不倒我们，把实现放到 UIView 的 Category 下面就好了。毕竟，作为有追求有代码洁癖的有志码农，我们决不允许重复代码的出现。<!-- more -->
但是，在这件我们常做的事情中，我们重构了两次，毕竟日常开发重构也在所难免，我们先谈另外一个更不爽的问题：我们换位思考一下，你在看这段别人实现的代码时，如何来判断**shakeAndZoom**方法的由来？表面上看去无法区分系统 API 和它的本质区别…难道要从头文件？又或者别人也在自己的 Category 下面实现了同名的类似方法呢？这又是个隐患。是时候展现真正的技术了，下面看看 Swift 通过 POP 是怎样做这件事的：
```swift
protocol ShakeAndZoom { }
extension ShakeAndZoom where Self: UIView {
	// 这里将此方法限制在了UIView类及其衍生类下面
	func shakeAndZoom() {
		// 具体实现
	}
}
// 任何需要此方法的类只需遵循上述协议
class XXView: UIImageView, ShakeAndZoom {

}
class XXButton: UIButton, ShakeAndZoom {

}
```
通过上面这种方式，我们既可以满足一次实现多次调用，而且结构清晰，通过遵循的协议就可以识别到相应的方法，在协议扩展力可以找到方法的实现。这样写出的代码灵活而不拘泥于接口和实现的耦合。不同类型的都可以按需实现协议，协议扩展也给添加新功能提供了便捷。
当然，再好的技术，也只能在它适用的场景发挥作用。所以，POP 同样不应该过度使用，有时一个独立的比如结构体或者类要比定义一个协议更加容易，也相对更容易理解，类型系统得简单，也更有利于增加代码的可读性。

-------

# & 最后
**POP** 给我们带来的最大好处是提供了一种**更小的实现接口**。协议只负责定义接口的功能，而针对多种类型的具体实现留给接口的使用者。这样，减少的依赖的关系，有利于搭建“**乐高式松耦合**”结构。毕竟是纸上谈兵，希望可以更快的将 Swift 应用到工业级项目中，得到更多实践机会，从中体会出更多细节……



